<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KESNNUR - Member Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js@1.11.2/src/toastify.min.css" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 260px;
        }
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, #1e3a8a 0%, #3b82f6 100%);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            color: white;
            overflow-y: auto;
        }
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            background: #f8fafc;
        }
        .nav-item {
            padding: 12px 20px;
            border-radius: 8px;
            margin: 4px 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge.active {
            background: #10b98120;
            color: #10b981;
        }
        .badge.pending {
            background: #f59e0b20;
            color: #f59e0b;
        }
        .badge.inactive {
            background: #ef444420;
            color: #ef4444;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .profile-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .event-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid #3b82f6;
        }
        .payment-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid #10b981;
        }
        .calendar-day {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
        }
        .calendar-day.event {
            background: #3b82f620;
            color: #1e40af;
        }
        .calendar-day.today {
            background: #10b98120;
            color: #065f46;
            font-weight: 600;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="p-6 border-b border-white/20">
            <div class="flex items-center space-x-3">
                <div class="bg-white/20 p-2 rounded-lg">
                    <i class="fas fa-user text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg">KESNNUR</h1>
                    <p class="text-white/80 text-xs">Member Portal</p>
                </div>
            </div>
        </div>
        
        <div class="p-4">
            <!-- DASHBOARD -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4">
                Dashboard
            </div>
            <div class="nav-item active" data-section="dashboard">
                <i class="fas fa-home mr-3"></i>
                My Dashboard
            </div>
            
            <!-- MY PROFILE -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4 mt-6">
                My Profile
            </div>
            <div class="nav-item" data-section="profile">
                <i class="fas fa-user-circle mr-3"></i>
                My Profile
            </div>
            <div class="nav-item" data-section="documents">
                <i class="fas fa-file-alt mr-3"></i>
                My Documents
            </div>
            
            <!-- MEMBERSHIP -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4 mt-6">
                Membership
            </div>
            <div class="nav-item" data-section="membership">
                <i class="fas fa-id-card mr-3"></i>
                Membership Card
            </div>
            <div class="nav-item" data-section="payments">
                <i class="fas fa-receipt mr-3"></i>
                Payment History
            </div>
            <div class="nav-item" data-section="renew">
                <i class="fas fa-sync-alt mr-3"></i>
                Renew Membership
            </div>
            
            <!-- EVENTS -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4 mt-6">
                Events
            </div>
            <div class="nav-item" data-section="events">
                <i class="fas fa-calendar-alt mr-3"></i>
                Events Calendar
            </div>
            <div class="nav-item" data-section="my-events">
                <i class="fas fa-clipboard-check mr-3"></i>
                My Registrations
            </div>
            
            <!-- CHAPTER -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4 mt-6">
                Chapter
            </div>
            <div class="nav-item" data-section="chapter">
                <i class="fas fa-users mr-3"></i>
                My Chapter
            </div>
            <div class="nav-item" data-section="members">
                <i class="fas fa-address-book mr-3"></i>
                Chapter Members
            </div>
            
            <!-- RESOURCES -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4 mt-6">
                Resources
            </div>
            <div class="nav-item" data-section="resources">
                <i class="fas fa-book mr-3"></i>
                Resources Library
            </div>
            <div class="nav-item" data-section="announcements">
                <i class="fas fa-bullhorn mr-3"></i>
                Announcements
            </div>
            
            <!-- SUPPORT -->
            <div class="text-white/60 text-xs font-semibold uppercase tracking-wider mb-2 px-4 mt-6">
                Support
            </div>
            <div class="nav-item" data-section="support">
                <i class="fas fa-question-circle mr-3"></i>
                Help & Support
            </div>
            <div class="nav-item" data-section="contact">
                <i class="fas fa-envelope mr-3"></i>
                Contact Us
            </div>
        </div>
        
        <!-- User Info -->
        <div class="p-4 border-t border-white/20 mt-auto">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white"></i>
                </div>
                <div>
                    <p class="font-medium" id="userName">Loading...</p>
                    <p class="text-white/60 text-sm" id="memberId">Loading...</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm transition-colors">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </button>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="p-6 border-b bg-white">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800" id="pageTitle">Member Dashboard</h1>
                    <p class="text-gray-600" id="welcomeMessage">Welcome back</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600" id="membershipStatus">
                        <span class="badge active">Active Member</span>
                    </div>
                    <div class="relative">
                        <button onclick="toggleNotifications()" class="p-2 text-gray-600 hover:text-gray-800 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">3</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="p-6" id="contentArea">
            <!-- Loading spinner -->
            <div class="flex items-center justify-center h-64">
                <div class="text-center">
                    <div class="loading mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading your dashboard...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for forms -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <!-- Modal content will be loaded here -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.11.2/src/toastify.min.js"></script>
    <script>
        // Configuration
        const SUPABASE_URL = 'https://noadhwqvaxajuckpibbo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vYWRod3F2YXhhanVja3BpYmJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxMDk0MDEsImV4cCI6MjA4NTY4NTQwMX0.tFqnonlgPjmcgC5KOiSriISFFE5FbdBrsVzsxURrbAw';
        
        // Initialize Supabase client
        let supabaseClient = null;
        let currentUser = null;
        let currentMember = null;
        
        // Show toast notifications
        function showToast(message, type = 'success') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                style: {
                    background: type === 'success' ? "#10b981" : type === 'error' ? "#ef4444" : "#3b82f6",
                },
                stopOnFocus: true,
            }).showToast();
        }
        
        // Initialize Supabase
        function initSupabase() {
            if (!supabaseClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
            return supabaseClient;
        }
        
        // Check authentication state
        async function checkAuth() {
            try {
                // Initialize Supabase
                const supabase = initSupabase();
                
                // Check for existing session
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError) {
                    console.error('Session error:', sessionError);
                    showToast('Authentication error', 'error');
                    return false;
                }
                
                if (!session || !session.user) {
                    console.log('No active session found');
                    return false;
                }
                
                currentUser = session.user;
                
                // Get member data by matching email
                const { data: member, error: memberError } = await supabase
                    .from('members')
                    .select('*')
                    .eq('email', session.user.email)
                    .single();
                
                if (memberError) {
                    console.error('Member error:', memberError);
                    showToast('Member profile not found', 'error');
                    return false;
                }
                
                if (!member) {
                    console.log('No member profile found');
                    showToast('Please complete your member registration', 'error');
                    return false;
                }
                
                currentMember = member;
                return true;
                
            } catch (error) {
                console.error('Auth check error:', error);
                showToast('Authentication error: ' + error.message, 'error');
                return false;
            }
        }
        
        // Initialize dashboard
        async function initializeDashboard() {
            try {
                // Show loading state
                document.getElementById('contentArea').innerHTML = `
                    <div class="flex items-center justify-center h-64">
                        <div class="text-center">
                            <div class="loading mx-auto mb-4"></div>
                            <p class="text-gray-600">Loading your dashboard...</p>
                        </div>
                    </div>
                `;
                
                // Check authentication
                const isAuthenticated = await checkAuth();
                
                if (!isAuthenticated) {
                    console.log('Member not authenticated, redirecting to login...');
                    showToast('Please login to access member portal', 'error');
                    setTimeout(() => {
                        window.location.href = 'member-login.html';
                    }, 1500);
                    return;
                }
                
                // Update user info
                updateUserInfo();
                
                // Setup event listeners
                setupEventListeners();
                
                // Load dashboard
                await loadDashboard();
                
                showToast('Welcome to KESNNUR Member Portal!', 'success');
                
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                showToast('Error loading dashboard: ' + error.message, 'error');
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-red-600 text-4xl mb-4">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">System Error</h3>
                        <p class="text-gray-600 mb-4">${error.message}</p>
                        <button onclick="initializeDashboard()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Retry
                        </button>
                    </div>
                `;
            }
        }
        
        function updateUserInfo() {
            if (!currentMember) return;
            
            const userName = document.getElementById('userName');
            const memberId = document.getElementById('memberId');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const membershipStatus = document.getElementById('membershipStatus');
            
            if (userName) {
                userName.textContent = 
                    currentMember.first_name && currentMember.last_name 
                        ? `${currentMember.first_name} ${currentMember.last_name}`
                        : currentMember.email || 'Member';
            }
            
            if (memberId) {
                memberId.textContent = currentMember.member_id || 'KESNNUR Member';
            }
            
            if (welcomeMessage) {
                welcomeMessage.textContent = 
                    `Welcome back, ${currentMember.first_name || 'Member'}`;
            }
            
            if (membershipStatus) {
                let badgeClass = 'badge ';
                let statusText = 'Member';
                
                if (currentMember.status === 'active') {
                    badgeClass += 'active';
                    statusText = 'Active Member';
                } else if (currentMember.status === 'pending') {
                    badgeClass += 'pending';
                    statusText = 'Pending Approval';
                } else if (currentMember.status === 'inactive') {
                    badgeClass += 'inactive';
                    statusText = 'Inactive Member';
                } else {
                    badgeClass += 'active';
                }
                
                membershipStatus.innerHTML = `<span class="${badgeClass}">${statusText}</span>`;
            }
        }
        
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    // Update active state
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Load section
                    loadSection(section);
                });
            });
        }
        
        async function loadSection(section) {
            const contentArea = document.getElementById('contentArea');
            
            // Check authentication first
            const isAuthenticated = await checkAuth();
            if (!isAuthenticated) {
                showToast('Session expired, please login again', 'error');
                window.location.href = 'member-login.html';
                return;
            }
            
            // Update page title
            const pageTitles = {
                'dashboard': 'My Dashboard',
                'profile': 'My Profile',
                'documents': 'My Documents',
                'membership': 'Membership Card',
                'payments': 'Payment History',
                'renew': 'Renew Membership',
                'events': 'Events Calendar',
                'my-events': 'My Registrations',
                'chapter': 'My Chapter',
                'members': 'Chapter Members',
                'resources': 'Resources Library',
                'announcements': 'Announcements',
                'support': 'Help & Support',
                'contact': 'Contact Us'
            };
            
            document.getElementById('pageTitle').textContent = pageTitles[section] || section;
            
            // Show loading
            contentArea.innerHTML = `
                <div class="flex items-center justify-center h-64">
                    <div class="text-center">
                        <div class="loading mx-auto mb-4"></div>
                        <p class="text-gray-600">Loading ${pageTitles[section] || section}...</p>
                    </div>
                </div>
            `;
            
            // Load the appropriate section
            switch(section) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'profile':
                    await loadProfile();
                    break;
                case 'membership':
                    await loadMembershipCard();
                    break;
                case 'payments':
                    await loadPaymentHistory();
                    break;
                case 'events':
                    await loadEventsCalendar();
                    break;
                case 'my-events':
                    await loadMyRegistrations();
                    break;
                case 'chapter':
                    await loadMyChapter();
                    break;
                case 'members':
                    await loadChapterMembers();
                    break;
                case 'announcements':
                    await loadAnnouncements();
                    break;
                case 'support':
                    await loadHelpSupport();
                    break;
                case 'contact':
                    await loadContactUs();
                    break;
                default:
                    await loadComingSoon(section, pageTitles[section] || section);
            }
        }
        
        // MAIN DASHBOARD
        async function loadDashboard() {
            try {
                const supabase = initSupabase();
                
                // Get upcoming events
                const { data: events } = await supabase
                    .from('events')
                    .select('*')
                    .gte('start_date', new Date().toISOString())
                    .order('start_date', { ascending: true })
                    .limit(3);
                
                // Get member's payments
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*')
                    .eq('member_id', currentMember.id)
                    .order('payment_date', { ascending: false })
                    .limit(3);
                
                // Get announcements
                const { data: announcements } = await supabase
                    .from('announcements')
                    .select('*')
                    .order('published_at', { ascending: false })
                    .limit(3);
                
                document.getElementById('contentArea').innerHTML = `
                    <!-- Welcome Banner -->
                    <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white mb-8">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-2xl font-bold mb-2">Welcome to KESNNUR</h2>
                                <p class="text-blue-100">Your one-stop member portal for all KESNNUR activities</p>
                            </div>
                            <div class="text-4xl">
                                <i class="fas fa-user-shield"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Left Column - Profile & Quick Stats -->
                        <div class="lg:col-span-1 space-y-6">
                            <!-- Profile Card -->
                            <div class="profile-card">
                                <div class="flex items-center mb-6">
                                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-user text-blue-900 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">${currentMember.first_name} ${currentMember.last_name}</h3>
                                        <p class="text-gray-600">${currentMember.member_id || 'KESNNUR Member'}</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Membership Status</span>
                                        <span class="badge ${currentMember.status === 'active' ? 'active' : currentMember.status === 'pending' ? 'pending' : 'inactive'}">
                                            ${currentMember.status || 'active'}
                                        </span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Chapter</span>
                                        <span class="font-medium">${currentMember.chapter || 'Not Assigned'}</span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Member Since</span>
                                        <span class="font-medium">${currentMember.created_at ? new Date(currentMember.created_at).toLocaleDateString() : 'N/A'}</span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Email</span>
                                        <span class="font-medium">${currentMember.email || 'N/A'}</span>
                                    </div>
                                </div>
                                
                                <button onclick="loadSection('profile')" class="w-full mt-6 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-edit mr-2"></i>Update Profile
                                </button>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="profile-card">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Quick Actions</h3>
                                <div class="space-y-3">
                                    <button onclick="loadSection('renew')" class="w-full text-left px-4 py-3 bg-green-50 text-green-700 rounded-lg hover:bg-green-100">
                                        <i class="fas fa-sync-alt mr-3"></i>Renew Membership
                                    </button>
                                    
                                    <button onclick="loadSection('documents')" class="w-full text-left px-4 py-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100">
                                        <i class="fas fa-file-download mr-3"></i>Download Documents
                                    </button>
                                    
                                    <button onclick="loadSection('support')" class="w-full text-left px-4 py-3 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100">
                                        <i class="fas fa-question-circle mr-3"></i>Get Help
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column - Events & Announcements -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Upcoming Events -->
                            <div class="profile-card">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-bold text-gray-800">Upcoming Events</h3>
                                    <button onclick="loadSection('events')" class="text-blue-600 hover:text-blue-800 text-sm">
                                        View All Events
                                    </button>
                                </div>
                                
                                <div class="space-y-4">
                                    ${events && events.length > 0 ? events.map(event => `
                                        <div class="event-card">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h4 class="font-bold text-gray-800">${event.title}</h4>
                                                    <p class="text-gray-600 text-sm mt-1">
                                                        <i class="fas fa-calendar-day mr-2"></i>
                                                        ${new Date(event.start_date).toLocaleDateString()} 
                                                        at ${event.start_date.includes('T') ? new Date(event.start_date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'TBA'}
                                                    </p>
                                                    ${event.location ? `
                                                        <p class="text-gray-600 text-sm mt-1">
                                                            <i class="fas fa-map-marker-alt mr-2"></i>${event.location}
                                                        </p>
                                                    ` : ''}
                                                </div>
                                                <button onclick="registerForEvent('${event.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                                    Register
                                                </button>
                                            </div>
                                            ${event.description ? `
                                                <p class="text-gray-700 mt-3">${event.description.substring(0, 120)}${event.description.length > 120 ? '...' : ''}</p>
                                            ` : ''}
                                        </div>
                                    `).join('') : `
                                        <div class="text-center py-8 text-gray-500">
                                            <i class="fas fa-calendar text-3xl mb-3"></i>
                                            <p>No upcoming events scheduled</p>
                                            <p class="text-sm mt-2">Check back later for new events</p>
                                        </div>
                                    `}
                                </div>
                            </div>
                            
                            <!-- Recent Announcements -->
                            <div class="profile-card">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-bold text-gray-800">Recent Announcements</h3>
                                    <button onclick="loadSection('announcements')" class="text-blue-600 hover:text-blue-800 text-sm">
                                        View All
                                    </button>
                                </div>
                                
                                <div class="space-y-4">
                                    ${announcements && announcements.length > 0 ? announcements.map(announcement => `
                                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                                            <h4 class="font-bold text-gray-800">${announcement.title}</h4>
                                            <p class="text-gray-600 text-sm mt-1">
                                                <i class="fas fa-clock mr-2"></i>
                                                ${new Date(announcement.published_at).toLocaleDateString()}
                                            </p>
                                            <p class="text-gray-700 mt-3">${announcement.content.substring(0, 100)}${announcement.content.length > 100 ? '...' : ''}</p>
                                        </div>
                                    `).join('') : `
                                        <div class="text-center py-8 text-gray-500">
                                            <i class="fas fa-bullhorn text-3xl mb-3"></i>
                                            <p>No announcements yet</p>
                                        </div>
                                    `}
                                </div>
                            </div>
                            
                            <!-- Recent Payments -->
                            <div class="profile-card">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-bold text-gray-800">Recent Payments</h3>
                                    <button onclick="loadSection('payments')" class="text-blue-600 hover:text-blue-800 text-sm">
                                        View History
                                    </button>
                                </div>
                                
                                <div class="space-y-4">
                                    ${payments && payments.length > 0 ? payments.map(payment => `
                                        <div class="payment-card">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <h4 class="font-bold text-gray-800">${payment.description || 'Membership Payment'}</h4>
                                                    <p class="text-gray-600 text-sm mt-1">
                                                        <i class="fas fa-calendar mr-2"></i>
                                                        ${new Date(payment.payment_date).toLocaleDateString()}
                                                    </p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="font-bold text-green-600">KSh ${parseFloat(payment.amount || 0).toLocaleString()}</p>
                                                    <span class="text-xs px-2 py-1 rounded-full ${payment.status === 'completed' ? 'bg-green-100 text-green-800' : payment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                                        ${payment.status || 'pending'}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('') : `
                                        <div class="text-center py-8 text-gray-500">
                                            <i class="fas fa-money-bill-wave text-3xl mb-3"></i>
                                            <p>No payment records found</p>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('contentArea').innerHTML = `
                    <div class="text-center py-12 text-red-600">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <p>Error loading dashboard: ${error.message}</p>
                        <button onclick="loadDashboard()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg">
                            Retry
                        </button>
                    </div>
                `;
            }
        }
        
        // MY PROFILE
        async function loadProfile() {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">My Profile</h2>
                            <button onclick="loadSection('dashboard')" class="px-4 py-2 text-gray-600 hover:text-gray-800">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="max-w-3xl">
                            <form id="profileForm" class="space-y-6">
                                <!-- Profile Photo -->
                                <div class="flex items-center space-x-6 mb-8">
                                    <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user text-blue-900 text-3xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-800">Profile Picture</h3>
                                        <p class="text-gray-600 text-sm mt-1">Upload a clear photo of yourself</p>
                                        <button type="button" class="mt-3 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm">
                                            <i class="fas fa-upload mr-2"></i>Upload Photo
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                        <input type="text" id="firstName" value="${currentMember.first_name || ''}" 
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                        <input type="text" id="lastName" value="${currentMember.last_name || ''}"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                                    <input type="email" id="email" value="${currentMember.email || ''}" disabled
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50">
                                    <p class="text-gray-500 text-sm mt-1">Contact admin to change email address</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                        <input type="tel" id="phone" value="${currentMember.phone || ''}"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Chapter</label>
                                        <select id="chapter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">Select Chapter</option>
                                            <option value="Nairobi" ${currentMember.chapter === 'Nairobi' ? 'selected' : ''}>Nairobi</option>
                                            <option value="Mombasa" ${currentMember.chapter === 'Mombasa' ? 'selected' : ''}>Mombasa</option>
                                            <option value="Kisumu" ${currentMember.chapter === 'Kisumu' ? 'selected' : ''}>Kisumu</option>
                                            <option value="Eldoret" ${currentMember.chapter === 'Eldoret' ? 'selected' : ''}>Eldoret</option>
                                            <option value="Nakuru" ${currentMember.chapter === 'Nakuru' ? 'selected' : ''}>Nakuru</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                                        <input type="date" id="dob"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                                        <select id="gender" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">Select Gender</option>
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                            <option value="prefer-not-to-say">Prefer not to say</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                    <textarea id="address" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">${currentMember.address || ''}</textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Occupation</label>
                                        <input type="text" id="occupation" value="${currentMember.occupation || ''}"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Company/Organization</label>
                                        <input type="text" id="company" value="${currentMember.company || ''}"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bio/About Me</label>
                                    <textarea id="bio" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Tell us about yourself...">${currentMember.bio || ''}</textarea>
                                </div>
                                
                                <div class="flex justify-end space-x-4 pt-6 border-t">
                                    <button type="button" onclick="loadSection('dashboard')" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        Cancel
                                    </button>
                                    <button type="button" onclick="updateProfile()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-save mr-2"></i>Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Populate additional fields if they exist in currentMember
            if (currentMember.dob) document.getElementById('dob').value = currentMember.dob.split('T')[0];
            if (currentMember.gender) document.getElementById('gender').value = currentMember.gender;
            if (currentMember.occupation) document.getElementById('occupation').value = currentMember.occupation;
            if (currentMember.company) document.getElementById('company').value = currentMember.company;
            if (currentMember.bio) document.getElementById('bio').value = currentMember.bio;
            if (currentMember.address) document.getElementById('address').value = currentMember.address;
        }
        
        // MEMBERSHIP CARD
        async function loadMembershipCard() {
            const today = new Date();
            const expiryDate = new Date();
            expiryDate.setFullYear(today.getFullYear() + 1);
            
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">Membership Card</h2>
                            <div class="flex space-x-3">
                                <button onclick="printCard()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-print mr-2"></i>Print
                                </button>
                                <button onclick="downloadCard()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-download mr-2"></i>Download
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="max-w-2xl mx-auto">
                            <!-- Membership Card -->
                            <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-2xl p-8 text-white mb-8">
                                <div class="flex justify-between items-start mb-6">
                                    <div>
                                        <h1 class="text-2xl font-bold mb-2">KESNNUR</h1>
                                        <p class="text-blue-200">Kenya Society of Nurses & Nursing Union</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm text-blue-200">Member ID</div>
                                        <div class="text-xl font-bold">${currentMember.member_id || 'KESNNUR-001'}</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center mb-8">
                                    <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mr-6">
                                        <i class="fas fa-user-nurse text-3xl"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-2xl font-bold">${currentMember.first_name} ${currentMember.last_name}</h2>
                                        <p class="text-blue-200">${currentMember.chapter || 'National Chapter'}</p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <div class="text-sm text-blue-200">Member Since</div>
                                        <div class="font-medium">${currentMember.created_at ? new Date(currentMember.created_at).toLocaleDateString() : today.toLocaleDateString()}</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-blue-200">Expires</div>
                                        <div class="font-medium">${expiryDate.toLocaleDateString()}</div>
                                    </div>
                                </div>
                                
                                <div class="mt-8 pt-6 border-t border-blue-500/30">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <div class="text-sm text-blue-200">Status</div>
                                            <div class="font-bold">${currentMember.status === 'active' ? 'ACTIVE MEMBER' : currentMember.status === 'pending' ? 'PENDING' : 'INACTIVE'}</div>
                                        </div>
                                        <div class="text-3xl">
                                            <i class="fas fa-shield-alt"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Card Details -->
                            <div class="bg-gray-50 rounded-xl p-6 mb-8">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Card Information</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <div class="flex items-center">
                                            <i class="fas fa-id-card text-blue-600 mr-3"></i>
                                            <div>
                                                <p class="font-medium">Card Number</p>
                                                <p class="text-sm text-gray-600">${currentMember.member_id || 'KESNNUR-001'}</p>
                                            </div>
                                        </div>
                                        <button onclick="copyToClipboard('${currentMember.member_id || 'KESNNUR-001'}')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200">
                                            Copy
                                        </button>
                                    </div>
                                    
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <div class="flex items-center">
                                            <i class="fas fa-calendar-alt text-green-600 mr-3"></i>
                                            <div>
                                                <p class="font-medium">Valid Until</p>
                                                <p class="text-sm text-gray-600">${expiryDate.toLocaleDateString()}</p>
                                            </div>
                                        </div>
                                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                                            Active
                                        </span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <div class="flex items-center">
                                            <i class="fas fa-users text-purple-600 mr-3"></i>
                                            <div>
                                                <p class="font-medium">Chapter</p>
                                                <p class="text-sm text-gray-600">${currentMember.chapter || 'Not Assigned'}</p>
                                            </div>
                                        </div>
                                        <button onclick="loadSection('chapter')" class="px-3 py-1 bg-purple-100 text-purple-700 rounded text-sm hover:bg-purple-200">
                                            View
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Card Benefits -->
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Membership Benefits</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <i class="fas fa-calendar-check text-green-600 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Event Access</p>
                                            <p class="text-sm text-gray-600">Access to all KESNNUR events</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <i class="fas fa-book-medical text-blue-600 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Resources</p>
                                            <p class="text-sm text-gray-600">Access to nursing resources</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <i class="fas fa-handshake text-purple-600 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Networking</p>
                                            <p class="text-sm text-gray-600">Connect with other nurses</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                        <i class="fas fa-graduation-cap text-orange-600 mr-3"></i>
                                        <div>
                                            <p class="font-medium">Training</p>
                                            <p class="text-sm text-gray-600">Professional development</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // PAYMENT HISTORY
        async function loadPaymentHistory() {
            try {
                const supabase = initSupabase();
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*')
                    .eq('member_id', currentMember.id)
                    .order('payment_date', { ascending: false });
                
                // Calculate total paid
                let totalPaid = 0;
                if (payments) {
                    payments.forEach(payment => {
                        if (payment.status === 'completed') {
                            totalPaid += parseFloat(payment.amount || 0);
                        }
                    });
                }
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">Payment History</h2>
                                <div class="flex space-x-3">
                                    <button onclick="exportPayments()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        <i class="fas fa-download mr-2"></i>Export
                                    </button>
                                    <button onclick="loadSection('renew')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-plus-circle mr-2"></i>Make Payment
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <!-- Payment Summary -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-blue-100 text-sm">Total Paid</p>
                                            <h3 class="text-2xl font-bold mt-1">KSh ${totalPaid.toLocaleString()}</h3>
                                        </div>
                                        <i class="fas fa-money-bill-wave text-2xl opacity-80"></i>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-green-100 text-sm">Total Transactions</p>
                                            <h3 class="text-2xl font-bold mt-1">${payments ? payments.length : 0}</h3>
                                        </div>
                                        <i class="fas fa-receipt text-2xl opacity-80"></i>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="text-purple-100 text-sm">Last Payment</p>
                                            <h3 class="text-2xl font-bold mt-1">
                                                ${payments && payments.length > 0 ? new Date(payments[0].payment_date).toLocaleDateString() : 'N/A'}
                                            </h3>
                                        </div>
                                        <i class="fas fa-calendar-check text-2xl opacity-80"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payments Table -->
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Date</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Description</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Amount</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Type</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Receipt</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${payments && payments.length > 0 ? payments.map(payment => `
                                            <tr class="border-b hover:bg-gray-50">
                                                <td class="px-4 py-3">
                                                    ${new Date(payment.payment_date).toLocaleDateString()}
                                                </td>
                                                <td class="px-4 py-3">${payment.description || 'Membership Payment'}</td>
                                                <td class="px-4 py-3 font-medium">KSh ${parseFloat(payment.amount || 0).toLocaleString()}</td>
                                                <td class="px-4 py-3">
                                                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                        ${payment.payment_type || 'membership'}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3">
                                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${payment.status === 'completed' ? 'bg-green-100 text-green-800' : payment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                                        ${payment.status || 'pending'}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3">
                                                    <button onclick="viewReceipt('${payment.id}')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm">
                                                        <i class="fas fa-eye mr-1"></i>View
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('') : `
                                            <tr>
                                                <td colspan="6" class="px-4 py-12 text-center text-gray-500">
                                                    <i class="fas fa-money-bill-wave text-3xl mb-3"></i>
                                                    <p class="text-lg">No payment records found</p>
                                                    <button onclick="loadSection('renew')" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                        Make Your First Payment
                                                    </button>
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Payment Information -->
                            <div class="mt-8 p-6 bg-blue-50 rounded-xl border border-blue-200">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Payment Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-medium text-gray-700 mb-2">Bank Transfer</h4>
                                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                                            <p class="text-sm text-gray-600 mb-1">Bank: KCB Bank</p>
                                            <p class="text-sm text-gray-600 mb-1">Account Name: KESNNUR</p>
                                            <p class="text-sm text-gray-600 mb-1">Account Number: 1234567890</p>
                                            <p class="text-sm text-gray-600">Branch: Nairobi Main</p>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-medium text-gray-700 mb-2">Mobile Money</h4>
                                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                                            <p class="text-sm text-gray-600 mb-1">Paybill: 123456</p>
                                            <p class="text-sm text-gray-600 mb-1">Account: ${currentMember.member_id || 'Your Member ID'}</p>
                                            <p class="text-sm text-gray-600">Send payment confirmation to: payments@kesnnur.org</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading payments:', error);
                showToast('Error loading payments: ' + error.message, 'error');
            }
        }
        
        // EVENTS CALENDAR
        async function loadEventsCalendar() {
            try {
                const supabase = initSupabase();
                const { data: events } = await supabase
                    .from('events')
                    .select('*')
                    .order('start_date', { ascending: true });
                
                // Get current month for calendar
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                // Generate calendar
                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                let calendarHTML = '';
                let dayCounter = 0;
                
                // Calendar header
                calendarHTML += '<div class="grid grid-cols-7 gap-2 mb-4">';
                ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                    calendarHTML += `<div class="text-center text-sm font-medium text-gray-500 py-2">${day}</div>`;
                });
                calendarHTML += '</div>';
                
                // Calendar days
                calendarHTML += '<div class="grid grid-cols-7 gap-2">';
                
                // Empty cells for days before the first day of month
                for (let i = 0; i < startingDay; i++) {
                    calendarHTML += '<div class="calendar-day"></div>';
                }
                
                // Days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDate = new Date(currentYear, currentMonth, day);
                    const isToday = day === now.getDate() && currentMonth === now.getMonth() && currentYear === now.getFullYear();
                    const hasEvent = events ? events.some(event => 
                        new Date(event.start_date).toDateString() === dayDate.toDateString()
                    ) : false;
                    
                    let dayClass = 'calendar-day';
                    if (isToday) dayClass += ' today';
                    if (hasEvent) dayClass += ' event';
                    
                    calendarHTML += `
                        <div class="${dayClass}" onclick="viewEventsForDate('${dayDate.toISOString()}')">
                            ${day}
                        </div>
                    `;
                }
                calendarHTML += '</div>';
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">Events Calendar</h2>
                                <button onclick="loadSection('my-events')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-clipboard-check mr-2"></i>My Registrations
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <!-- Calendar -->
                                <div class="lg:col-span-2">
                                    <div class="mb-6">
                                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                                            ${now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                                        </h3>
                                        ${calendarHTML}
                                    </div>
                                    
                                    <!-- Upcoming Events -->
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-800 mb-4">Upcoming Events</h3>
                                        ${events && events.length > 0 ? events.filter(event => 
                                            new Date(event.start_date) >= new Date()
                                        ).map(event => `
                                            <div class="border border-gray-200 rounded-lg p-4 mb-3 hover:bg-gray-50">
                                                <div class="flex justify-between items-start">
                                                    <div>
                                                        <h4 class="font-bold text-gray-800">${event.title}</h4>
                                                        <p class="text-gray-600 text-sm mt-1">
                                                            <i class="fas fa-calendar-day mr-2"></i>
                                                            ${new Date(event.start_date).toLocaleDateString()} 
                                                            ${event.start_date.includes('T') ? ' at ' + new Date(event.start_date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : ''}
                                                        </p>
                                                        ${event.location ? `
                                                            <p class="text-gray-600 text-sm mt-1">
                                                                <i class="fas fa-map-marker-alt mr-2"></i>${event.location}
                                                            </p>
                                                        ` : ''}
                                                    </div>
                                                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                                                        ${event.status || 'upcoming'}
                                                    </span>
                                                </div>
                                                ${event.description ? `
                                                    <p class="text-gray-700 mt-3 text-sm">${event.description.substring(0, 100)}${event.description.length > 100 ? '...' : ''}</p>
                                                ` : ''}
                                                <div class="flex justify-end space-x-2 mt-4">
                                                    <button onclick="viewEventDetails('${event.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                                        <i class="fas fa-info-circle mr-1"></i>Details
                                                    </button>
                                                    <button onclick="registerForEvent('${event.id}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">
                                                        <i class="fas fa-calendar-plus mr-1"></i>Register
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('') : `
                                            <div class="text-center py-8 text-gray-500">
                                                <i class="fas fa-calendar text-3xl mb-3"></i>
                                                <p>No upcoming events scheduled</p>
                                                <p class="text-sm mt-2">Check back later for new events</p>
                                            </div>
                                        `}
                                    </div>
                                </div>
                                
                                <!-- Event Categories -->
                                <div>
                                    <div class="bg-gray-50 rounded-xl p-6">
                                        <h3 class="text-lg font-bold text-gray-800 mb-4">Event Categories</h3>
                                        <div class="space-y-3">
                                            <button onclick="filterEvents('workshop')" class="w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50">
                                                <i class="fas fa-chalkboard-teacher text-blue-600 mr-3"></i>
                                                <span class="font-medium">Workshops</span>
                                            </button>
                                            
                                            <button onclick="filterEvents('conference')" class="w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50">
                                                <i class="fas fa-users text-green-600 mr-3"></i>
                                                <span class="font-medium">Conferences</span>
                                            </button>
                                            
                                            <button onclick="filterEvents('training')" class="w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50">
                                                <i class="fas fa-graduation-cap text-purple-600 mr-3"></i>
                                                <span class="font-medium">Training</span>
                                            </button>
                                            
                                            <button onclick="filterEvents('social')" class="w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50">
                                                <i class="fas fa-glass-cheers text-orange-600 mr-3"></i>
                                                <span class="font-medium">Social Events</span>
                                            </button>
                                        </div>
                                        
                                        <div class="mt-6 pt-6 border-t border-gray-200">
                                            <h4 class="font-medium text-gray-700 mb-3">My Event Stats</h4>
                                            <div class="space-y-3">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-600">Registered Events</span>
                                                    <span class="font-bold">0</span>
                                                </div>
                                                
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-600">Attended Events</span>
                                                    <span class="font-bold">0</span>
                                                </div>
                                                
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-600">Upcoming Events</span>
                                                    <span class="font-bold">${events ? events.filter(e => new Date(e.start_date) >= new Date()).length : 0}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading events:', error);
                showToast('Error loading events: ' + error.message, 'error');
            }
        }
        
        // MY CHAPTER
        async function loadMyChapter() {
            try {
                const supabase = initSupabase();
                const { data: chapter } = await supabase
                    .from('chapters')
                    .select('*')
                    .eq('name', currentMember.chapter)
                    .single();
                
                // Get chapter members
                const { data: chapterMembers } = await supabase
                    .from('members')
                    .select('id, first_name, last_name, email, status')
                    .eq('chapter', currentMember.chapter)
                    .order('first_name');
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">My Chapter</h2>
                                <button onclick="loadSection('members')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-users mr-2"></i>View Members
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            ${chapter ? `
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <!-- Chapter Info -->
                                    <div class="lg:col-span-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white mb-6">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h3 class="text-2xl font-bold mb-2">${chapter.name}</h3>
                                                    <p class="text-blue-200">${chapter.location || 'KESNNUR Chapter'}</p>
                                                </div>
                                                <div class="text-4xl">
                                                    <i class="fas fa-map-marker-alt"></i>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        ${chapter.description ? `
                                            <div class="prose max-w-none mb-6">
                                                <h4 class="text-lg font-bold text-gray-800 mb-3">About Our Chapter</h4>
                                                <p class="text-gray-700">${chapter.description}</p>
                                            </div>
                                        ` : ''}
                                        
                                        <!-- Chapter Contact -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                            ${chapter.contact_email ? `
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <div class="flex items-center">
                                                        <i class="fas fa-envelope text-blue-600 text-xl mr-3"></i>
                                                        <div>
                                                            <p class="font-medium text-gray-800">Email</p>
                                                            <p class="text-gray-600 text-sm">${chapter.contact_email}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ` : ''}
                                            
                                            ${chapter.contact_phone ? `
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <div class="flex items-center">
                                                        <i class="fas fa-phone text-green-600 text-xl mr-3"></i>
                                                        <div>
                                                            <p class="font-medium text-gray-800">Phone</p>
                                                            <p class="text-gray-600 text-sm">${chapter.contact_phone}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        <!-- Chapter Members Preview -->
                                        <div>
                                            <h4 class="text-lg font-bold text-gray-800 mb-4">Chapter Members (${chapterMembers ? chapterMembers.length : 0})</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                ${chapterMembers && chapterMembers.length > 0 ? chapterMembers.slice(0, 6).map(member => `
                                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                                        <div class="flex items-center">
                                                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                                <i class="fas fa-user text-blue-900"></i>
                                                            </div>
                                                            <div>
                                                                <p class="font-medium text-gray-800">${member.first_name} ${member.last_name}</p>
                                                                <p class="text-gray-600 text-sm">${member.status || 'Member'}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('') : `
                                                    <div class="col-span-3 text-center py-8 text-gray-500">
                                                        <i class="fas fa-users text-3xl mb-3"></i>
                                                        <p>No members in this chapter yet</p>
                                                    </div>
                                                `}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Chapter Stats -->
                                    <div>
                                        <div class="bg-gray-50 rounded-xl p-6">
                                            <h4 class="text-lg font-bold text-gray-800 mb-4">Chapter Statistics</h4>
                                            <div class="space-y-4">
                                                <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                                                    <div>
                                                        <p class="text-sm text-gray-600">Total Members</p>
                                                        <p class="text-2xl font-bold">${chapterMembers ? chapterMembers.length : 0}</p>
                                                    </div>
                                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                                </div>
                                                
                                                <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                                                    <div>
                                                        <p class="text-sm text-gray-600">Active Members</p>
                                                        <p class="text-2xl font-bold">${chapterMembers ? chapterMembers.filter(m => m.status === 'active').length : 0}</p>
                                                    </div>
                                                    <i class="fas fa-user-check text-green-600 text-xl"></i>
                                                </div>
                                                
                                                <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200">
                                                    <div>
                                                        <p class="text-sm text-gray-600">Events This Year</p>
                                                        <p class="text-2xl font-bold">0</p>
                                                    </div>
                                                    <i class="fas fa-calendar-alt text-purple-600 text-xl"></i>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-6 pt-6 border-t border-gray-200">
                                                <h4 class="font-medium text-gray-700 mb-3">Chapter Leadership</h4>
                                                <div class="space-y-3">
                                                    <div class="flex items-center">
                                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                            <i class="fas fa-crown text-yellow-600"></i>
                                                        </div>
                                                        <div>
                                                            <p class="font-medium">Chapter Chair</p>
                                                            <p class="text-gray-600 text-sm">Not assigned yet</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="flex items-center">
                                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                            <i class="fas fa-user-friends text-blue-600"></i>
                                                        </div>
                                                        <div>
                                                            <p class="font-medium">Vice Chair</p>
                                                            <p class="text-gray-600 text-sm">Not assigned yet</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-6">
                                                <button onclick="joinChapterEvent()" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                    <i class="fas fa-calendar-plus mr-2"></i>Join Next Meeting
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="text-center py-12">
                                    <div class="text-blue-600 text-4xl mb-4">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <h3 class="text-xl font-bold mb-2">No Chapter Assigned</h3>
                                    <p class="text-gray-600 mb-4">You haven't been assigned to a chapter yet.</p>
                                    <button onclick="loadSection('profile')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-edit mr-2"></i>Update Your Profile
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading chapter:', error);
                showToast('Error loading chapter: ' + error.message, 'error');
            }
        }
        
        // CHAPTER MEMBERS
        async function loadChapterMembers() {
            try {
                const supabase = initSupabase();
                const { data: chapterMembers } = await supabase
                    .from('members')
                    .select('*')
                    .eq('chapter', currentMember.chapter)
                    .order('first_name');
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">Chapter Members</h2>
                                <div class="flex space-x-3">
                                    <button onclick="loadSection('chapter')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        <i class="fas fa-arrow-left mr-2"></i>Back to Chapter
                                    </button>
                                    <button onclick="exportMembers()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        <i class="fas fa-download mr-2"></i>Export List
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <!-- Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                                    <p class="text-sm text-blue-600 font-medium">Total Members</p>
                                    <p class="text-2xl font-bold mt-1">${chapterMembers ? chapterMembers.length : 0}</p>
                                </div>
                                
                                <div class="bg-green-50 rounded-lg p-4 border border-green-100">
                                    <p class="text-sm text-green-600 font-medium">Active Members</p>
                                    <p class="text-2xl font-bold mt-1">${chapterMembers ? chapterMembers.filter(m => m.status === 'active').length : 0}</p>
                                </div>
                                
                                <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-100">
                                    <p class="text-sm text-yellow-600 font-medium">Pending Members</p>
                                    <p class="text-2xl font-bold mt-1">${chapterMembers ? chapterMembers.filter(m => m.status === 'pending').length : 0}</p>
                                </div>
                                
                                <div class="bg-purple-50 rounded-lg p-4 border border-purple-100">
                                    <p class="text-sm text-purple-600 font-medium">Your Position</p>
                                    <p class="text-2xl font-bold mt-1">Member</p>
                                </div>
                            </div>
                            
                            <!-- Search and Filter -->
                            <div class="mb-6">
                                <div class="flex flex-col md:flex-row gap-4">
                                    <div class="flex-1">
                                        <div class="relative">
                                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                            <input type="text" id="searchMembers" placeholder="Search members by name or email..." 
                                                   class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <select id="filterStatus" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="pending">Pending</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                        <button onclick="searchMembers()" class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                            <i class="fas fa-filter mr-2"></i>Filter
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Members Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="membersGrid">
                                ${chapterMembers && chapterMembers.length > 0 ? chapterMembers.map(member => `
                                    <div class="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-md transition-shadow">
                                        <div class="flex items-center mb-4">
                                            <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                                <i class="fas fa-user text-blue-900 text-xl"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-800">${member.first_name} ${member.last_name}</h4>
                                                <p class="text-gray-600 text-sm">${member.email || 'No email'}</p>
                                            </div>
                                        </div>
                                        
                                        <div class="space-y-3 mb-4">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-600 text-sm">Status</span>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${member.status === 'active' ? 'bg-green-100 text-green-800' : member.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                                    ${member.status || 'member'}
                                                </span>
                                            </div>
                                            
                                            ${member.phone ? `
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-600 text-sm">Phone</span>
                                                    <span class="font-medium text-sm">${member.phone}</span>
                                                </div>
                                            ` : ''}
                                            
                                            ${member.occupation ? `
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-600 text-sm">Occupation</span>
                                                    <span class="font-medium text-sm">${member.occupation}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        <div class="flex space-x-2">
                                            <button onclick="viewMemberProfile('${member.id}')" class="flex-1 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 text-sm">
                                                <i class="fas fa-eye mr-1"></i>View
                                            </button>
                                            <button onclick="messageMember('${member.id}')" class="flex-1 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 text-sm">
                                                <i class="fas fa-envelope mr-1"></i>Message
                                            </button>
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div class="col-span-3 text-center py-12 text-gray-500">
                                        <i class="fas fa-users text-3xl mb-3"></i>
                                        <p class="text-lg">No members in this chapter yet</p>
                                        <p class="text-sm mt-2">Members will appear here once they join your chapter</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading chapter members:', error);
                showToast('Error loading chapter members: ' + error.message, 'error');
            }
        }
        
        // ANNOUNCEMENTS
        async function loadAnnouncements() {
            try {
                const supabase = initSupabase();
                const { data: announcements } = await supabase
                    .from('announcements')
                    .select('*')
                    .order('published_at', { ascending: false });
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">Announcements</h2>
                                <button onclick="loadSection('dashboard')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            ${announcements && announcements.length > 0 ? announcements.map(announcement => `
                                <div class="border border-gray-200 rounded-xl p-6 mb-6 hover:bg-gray-50 transition-colors">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-800 mb-2">${announcement.title}</h3>
                                            <div class="flex items-center text-gray-600 text-sm">
                                                <i class="fas fa-clock mr-2"></i>
                                                ${new Date(announcement.published_at).toLocaleDateString('en-US', {
                                                    year: 'numeric',
                                                    month: 'long',
                                                    day: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                })}
                                            </div>
                                        </div>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                                            ${announcement.category || 'General'}
                                        </span>
                                    </div>
                                    
                                    <div class="prose max-w-none mb-4">
                                        <p class="text-gray-700">${announcement.content}</p>
                                    </div>
                                    
                                    ${announcement.attachment_url ? `
                                        <div class="mt-4">
                                            <a href="${announcement.attachment_url}" target="_blank" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
                                                <i class="fas fa-paperclip mr-2"></i>
                                                Download Attachment
                                            </a>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : `
                                <div class="text-center py-12">
                                    <div class="text-gray-400 text-4xl mb-4">
                                        <i class="fas fa-bullhorn"></i>
                                    </div>
                                    <h3 class="text-xl font-bold mb-2">No Announcements</h3>
                                    <p class="text-gray-600">Check back later for announcements from KESNNUR leadership</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading announcements:', error);
                showToast('Error loading announcements: ' + error.message, 'error');
            }
        }
        
        // HELP & SUPPORT
        async function loadHelpSupport() {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">Help & Support</h2>
                            <button onclick="loadSection('dashboard')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- FAQ -->
                            <div class="lg:col-span-2">
                                <h3 class="text-lg font-bold text-gray-800 mb-6">Frequently Asked Questions</h3>
                                
                                <div class="space-y-4">
                                    <div class="border border-gray-200 rounded-lg p-5">
                                        <h4 class="font-bold text-gray-800 mb-2">How do I renew my membership?</h4>
                                        <p class="text-gray-600">You can renew your membership by going to the "Renew Membership" section and following the payment instructions. Payments can be made via bank transfer or mobile money.</p>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-5">
                                        <h4 class="font-bold text-gray-800 mb-2">How can I update my profile information?</h4>
                                        <p class="text-gray-600">Go to "My Profile" section where you can edit and update your personal information, contact details, and other profile information.</p>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-5">
                                        <h4 class="font-bold text-gray-800 mb-2">How do I register for events?</h4>
                                        <p class="text-gray-600">Navigate to the "Events Calendar" section, browse upcoming events, and click the "Register" button on any event you wish to attend.</p>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-5">
                                        <h4 class="font-bold text-gray-800 mb-2">How can I get my membership card?</h4>
                                        <p class="text-gray-600">Your digital membership card is available in the "Membership Card" section. You can download or print it from there.</p>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-5">
                                        <h4 class="font-bold text-gray-800 mb-2">Who should I contact for technical issues?</h4>
                                        <p class="text-gray-600">For technical issues with the portal, please contact our support team at support@kesnnur.org or call +254 700 000 000.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contact Support -->
                            <div>
                                <div class="bg-gray-50 rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">Contact Support</h3>
                                    
                                    <div class="space-y-4">
                                        <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                            <i class="fas fa-envelope text-blue-600 text-xl mr-3"></i>
                                            <div>
                                                <p class="font-medium text-gray-800">Email Support</p>
                                                <p class="text-gray-600 text-sm">support@kesnnur.org</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                            <i class="fas fa-phone text-green-600 text-xl mr-3"></i>
                                            <div>
                                                <p class="font-medium text-gray-800">Phone Support</p>
                                                <p class="text-gray-600 text-sm">+254 700 000 000</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex items-center p-3 bg-white rounded-lg border border-gray-200">
                                            <i class="fas fa-clock text-yellow-600 text-xl mr-3"></i>
                                            <div>
                                                <p class="font-medium text-gray-800">Support Hours</p>
                                                <p class="text-gray-600 text-sm">Mon-Fri: 8AM-5PM</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Support Form -->
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h4 class="font-medium text-gray-700 mb-3">Send a Message</h4>
                                        <div class="space-y-3">
                                            <input type="text" id="supportSubject" placeholder="Subject" 
                                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <textarea id="supportMessage" rows="4" placeholder="Describe your issue..."
                                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                                            <button onclick="submitSupportRequest()" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                <i class="fas fa-paper-plane mr-2"></i>Send Message
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // CONTACT US
        async function loadContactUs() {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">Contact Us</h2>
                            <button onclick="loadSection('dashboard')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Contact Information -->
                            <div>
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white mb-6">
                                    <h3 class="text-2xl font-bold mb-4">KESNNUR Headquarters</h3>
                                    <p class="text-blue-200">Kenya Society of Nurses & Nursing Union</p>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="flex items-start p-4 bg-gray-50 rounded-lg">
                                        <i class="fas fa-map-marker-alt text-blue-600 text-xl mr-3 mt-1"></i>
                                        <div>
                                            <p class="font-medium text-gray-800">Address</p>
                                            <p class="text-gray-600 text-sm">Nairobi CBD, Moi Avenue</p>
                                            <p class="text-gray-600 text-sm">P.O. Box 12345-00100</p>
                                            <p class="text-gray-600 text-sm">Nairobi, Kenya</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start p-4 bg-gray-50 rounded-lg">
                                        <i class="fas fa-phone text-green-600 text-xl mr-3 mt-1"></i>
                                        <div>
                                            <p class="font-medium text-gray-800">Phone Numbers</p>
                                            <p class="text-gray-600 text-sm">+254 20 123 4567</p>
                                            <p class="text-gray-600 text-sm">+254 700 000 000</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start p-4 bg-gray-50 rounded-lg">
                                        <i class="fas fa-envelope text-purple-600 text-xl mr-3 mt-1"></i>
                                        <div>
                                            <p class="font-medium text-gray-800">Email Addresses</p>
                                            <p class="text-gray-600 text-sm">info@kesnnur.org</p>
                                            <p class="text-gray-600 text-sm">membership@kesnnur.org</p>
                                            <p class="text-gray-600 text-sm">support@kesnnur.org</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contact Form -->
                            <div class="lg:col-span-2">
                                <div class="bg-gray-50 rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-gray-800 mb-6">Send Us a Message</h3>
                                    
                                    <form id="contactForm" class="space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Your Name *</label>
                                                <input type="text" id="contactName" value="${currentMember.first_name} ${currentMember.last_name}"
                                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Your Email *</label>
                                                <input type="email" id="contactEmail" value="${currentMember.email}"
                                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject *</label>
                                            <input type="text" id="contactSubject" placeholder="What is this regarding?"
                                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                                            <select id="contactDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                                <option value="">Select Department</option>
                                                <option value="membership">Membership Services</option>
                                                <option value="events">Events & Programs</option>
                                                <option value="technical">Technical Support</option>
                                                <option value="billing">Billing & Payments</option>
                                                <option value="general">General Inquiry</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Message *</label>
                                            <textarea id="contactMessage" rows="6" placeholder="Type your message here..."
                                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                                        </div>
                                        
                                        <div class="flex items-center">
                                            <input type="checkbox" id="contactCopy" class="h-4 w-4 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                                            <label for="contactCopy" class="ml-2 text-sm text-gray-700">
                                                Send me a copy of this message
                                            </label>
                                        </div>
                                        
                                        <button type="button" onclick="submitContactForm()" class="w-full px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                                            <i class="fas fa-paper-plane mr-2"></i>Send Message
                                        </button>
                                    </form>
                                </div>
                                
                                <!-- Social Media -->
                                <div class="mt-6">
                                    <h4 class="text-lg font-bold text-gray-800 mb-4">Follow Us</h4>
                                    <div class="flex space-x-4">
                                        <a href="#" class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700">
                                            <i class="fab fa-facebook-f"></i>
                                        </a>
                                        <a href="#" class="w-12 h-12 bg-blue-400 text-white rounded-full flex items-center justify-center hover:bg-blue-500">
                                            <i class="fab fa-twitter"></i>
                                        </a>
                                        <a href="#" class="w-12 h-12 bg-pink-600 text-white rounded-full flex items-center justify-center hover:bg-pink-700">
                                            <i class="fab fa-instagram"></i>
                                        </a>
                                        <a href="#" class="w-12 h-12 bg-blue-700 text-white rounded-full flex items-center justify-center hover:bg-blue-800">
                                            <i class="fab fa-linkedin-in"></i>
                                        </a>
                                        <a href="#" class="w-12 h-12 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700">
                                            <i class="fab fa-whatsapp"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // COMING SOON PAGE
        async function loadComingSoon(section, title) {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <h2 class="text-xl font-bold text-gray-800">${title}</h2>
                    </div>
                    
                    <div class="p-12 text-center">
                        <div class="text-blue-600 text-5xl mb-6">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Feature Coming Soon!</h3>
                        <p class="text-gray-600 max-w-md mx-auto mb-8">
                            The "${title}" section is currently under development. 
                            We're working hard to bring you this feature soon.
                        </p>
                        <button onclick="loadSection('dashboard')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </button>
                    </div>
                </div>
            `;
        }
        
        // MY REGISTRATIONS
        async function loadMyRegistrations() {
            try {
                const supabase = initSupabase();
                
                // Get member's event registrations
                const { data: registrations } = await supabase
                    .from('event_registrations')
                    .select(`
                        *,
                        events:event_id (*)
                    `)
                    .eq('member_id', currentMember.id)
                    .order('registration_date', { ascending: false });
                
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">My Event Registrations</h2>
                                <button onclick="loadSection('events')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-calendar-alt mr-2"></i>Browse Events
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            ${registrations && registrations.length > 0 ? `
                                <div class="space-y-6">
                                    ${registrations.map(reg => `
                                        <div class="border border-gray-200 rounded-xl p-6 hover:bg-gray-50">
                                            <div class="flex justify-between items-start mb-4">
                                                <div>
                                                    <h3 class="text-xl font-bold text-gray-800 mb-2">${reg.events?.title || 'Event'}</h3>
                                                    <div class="flex items-center text-gray-600 text-sm">
                                                        <i class="fas fa-calendar-day mr-2"></i>
                                                        ${reg.events?.start_date ? new Date(reg.events.start_date).toLocaleDateString('en-US', {
                                                            year: 'numeric',
                                                            month: 'long',
                                                            day: 'numeric',
                                                            hour: '2-digit',
                                                            minute: '2-digit'
                                                        }) : 'Date not specified'}
                                                    </div>
                                                </div>
                                                <span class="px-3 py-1 ${reg.status === 'confirmed' ? 'bg-green-100 text-green-800' : reg.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'} rounded-full text-xs font-medium">
                                                    ${reg.status || 'pending'}
                                                </span>
                                            </div>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <p class="text-sm text-gray-600">Registration ID</p>
                                                    <p class="font-medium">${reg.registration_code || 'N/A'}</p>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-600">Registration Date</p>
                                                    <p class="font-medium">${new Date(reg.registration_date).toLocaleDateString()}</p>
                                                </div>
                                            </div>
                                            
                                            ${reg.events?.description ? `
                                                <p class="text-gray-700 mb-4">${reg.events.description}</p>
                                            ` : ''}
                                            
                                            <div class="flex justify-end space-x-3">
                                                <button onclick="cancelRegistration('${reg.id}')" class="px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50">
                                                    <i class="fas fa-times mr-2"></i>Cancel
                                                </button>
                                                <button onclick="downloadTicket('${reg.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                    <i class="fas fa-download mr-2"></i>Download Ticket
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="text-center py-12">
                                    <div class="text-gray-400 text-4xl mb-4">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <h3 class="text-xl font-bold mb-2">No Event Registrations</h3>
                                    <p class="text-gray-600 mb-6">You haven't registered for any events yet.</p>
                                    <button onclick="loadSection('events')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-calendar-plus mr-2"></i>Browse Upcoming Events
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading registrations:', error);
                showToast('Error loading registrations: ' + error.message, 'error');
            }
        }
        
        // DOCUMENTS PAGE
        async function loadDocuments() {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">My Documents</h2>
                            <button onclick="loadSection('dashboard')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="text-blue-100 text-sm">Total Documents</p>
                                        <h3 class="text-2xl font-bold mt-1">0</h3>
                                    </div>
                                    <i class="fas fa-folder text-2xl opacity-80"></i>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="text-green-100 text-sm">Available for Download</p>
                                        <h3 class="text-2xl font-bold mt-1">0</h3>
                                    </div>
                                    <i class="fas fa-download text-2xl opacity-80"></i>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="text-purple-100 text-sm">Last Updated</p>
                                        <h3 class="text-2xl font-bold mt-1">N/A</h3>
                                    </div>
                                    <i class="fas fa-clock text-2xl opacity-80"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center py-12">
                            <div class="text-gray-400 text-4xl mb-4">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2">No Documents Available</h3>
                            <p class="text-gray-600">Your documents will appear here once they are uploaded by the administrator.</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // RENEW MEMBERSHIP
        async function loadRenewMembership() {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">Renew Membership</h2>
                            <button onclick="loadSection('dashboard')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Membership Plans -->
                            <div class="lg:col-span-2">
                                <h3 class="text-lg font-bold text-gray-800 mb-6">Select Membership Plan</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div class="border border-gray-200 rounded-xl p-6 hover:border-blue-500 transition-colors">
                                        <div class="text-center mb-6">
                                            <h4 class="text-xl font-bold text-gray-800 mb-2">Basic</h4>
                                            <div class="text-3xl font-bold text-blue-600">KSh 2,000</div>
                                            <p class="text-gray-600 text-sm">per year</p>
                                        </div>
                                        
                                        <ul class="space-y-3 mb-6">
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">Basic member benefits</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">Access to events</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-times text-gray-300 mr-2"></i>
                                                <span class="text-gray-400">Premium resources</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-times text-gray-300 mr-2"></i>
                                                <span class="text-gray-400">Leadership opportunities</span>
                                            </li>
                                        </ul>
                                        
                                        <button onclick="selectPlan('basic')" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                            Select Basic Plan
                                        </button>
                                    </div>
                                    
                                    <div class="border-2 border-blue-500 rounded-xl p-6 bg-blue-50">
                                        <div class="text-center mb-6">
                                            <span class="px-3 py-1 bg-blue-500 text-white rounded-full text-xs font-medium mb-2 inline-block">POPULAR</span>
                                            <h4 class="text-xl font-bold text-gray-800 mb-2">Professional</h4>
                                            <div class="text-3xl font-bold text-blue-600">KSh 5,000</div>
                                            <p class="text-gray-600 text-sm">per year</p>
                                        </div>
                                        
                                        <ul class="space-y-3 mb-6">
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">All basic benefits</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">Premium resources access</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">CPD accreditation</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">Networking events</span>
                                            </li>
                                        </ul>
                                        
                                        <button onclick="selectPlan('professional')" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                            Select Professional Plan
                                        </button>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-xl p-6 hover:border-blue-500 transition-colors">
                                        <div class="text-center mb-6">
                                            <h4 class="text-xl font-bold text-gray-800 mb-2">Premium</h4>
                                            <div class="text-3xl font-bold text-blue-600">KSh 10,000</div>
                                            <p class="text-gray-600 text-sm">per year</p>
                                        </div>
                                        
                                        <ul class="space-y-3 mb-6">
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">All professional benefits</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">Leadership training</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">Mentorship program</span>
                                            </li>
                                            <li class="flex items-center">
                                                <i class="fas fa-check text-green-500 mr-2"></i>
                                                <span class="text-gray-700">International recognition</span>
                                            </li>
                                        </ul>
                                        
                                        <button onclick="selectPlan('premium')" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                            Select Premium Plan
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Summary -->
                            <div>
                                <div class="bg-gray-50 rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">Payment Summary</h3>
                                    
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600">Selected Plan</span>
                                            <span class="font-medium" id="selectedPlanText">None</span>
                                        </div>
                                        
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600">Amount</span>
                                            <span class="font-medium" id="planAmount">KSh 0</span>
                                        </div>
                                        
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600">Duration</span>
                                            <span class="font-medium">1 Year</span>
                                        </div>
                                        
                                        <div class="border-t border-gray-200 pt-4">
                                            <div class="flex justify-between items-center">
                                                <span class="text-lg font-bold">Total</span>
                                                <span class="text-xl font-bold text-blue-600" id="totalAmount">KSh 0</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6">
                                        <h4 class="font-medium text-gray-700 mb-3">Payment Method</h4>
                                        <div class="space-y-2">
                                            <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                                                <input type="radio" id="bankTransfer" name="paymentMethod" checked class="h-4 w-4 text-blue-600">
                                                <label for="bankTransfer" class="ml-2 flex-1">Bank Transfer</label>
                                            </div>
                                            
                                            <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                                                <input type="radio" id="mobileMoney" name="paymentMethod" class="h-4 w-4 text-blue-600">
                                                <label for="mobileMoney" class="ml-2 flex-1">Mobile Money</label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button onclick="processPayment()" class="w-full mt-6 px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
                                        <i class="fas fa-lock mr-2"></i>Proceed to Payment
                                    </button>
                                    
                                    <p class="text-center text-gray-500 text-sm mt-4">
                                        Your membership will be activated upon payment confirmation
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // RESOURCES LIBRARY
        async function loadResourcesLibrary() {
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-xl shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">Resources Library</h2>
                            <button onclick="loadSection('dashboard')" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="text-center py-12">
                            <div class="text-blue-600 text-4xl mb-4">
                                <i class="fas fa-book-medical"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Resources Library</h3>
                            <p class="text-gray-600 mb-6">Access nursing guidelines, research papers, and professional resources.</p>
                            <div class="flex justify-center space-x-4">
                                <button class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-graduation-cap mr-2"></i>Training Materials
                                </button>
                                <button class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-file-pdf mr-2"></i>Guidelines
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Helper Functions
        async function updateProfile() {
            try {
                const supabase = initSupabase();
                
                const profileData = {
                    first_name: document.getElementById('firstName').value,
                    last_name: document.getElementById('lastName').value,
                    phone: document.getElementById('phone').value,
                    chapter: document.getElementById('chapter').value,
                    dob: document.getElementById('dob').value || null,
                    gender: document.getElementById('gender').value || null,
                    address: document.getElementById('address').value || null,
                    occupation: document.getElementById('occupation').value || null,
                    company: document.getElementById('company').value || null,
                    bio: document.getElementById('bio').value || null,
                    updated_at: new Date().toISOString()
                };
                
                const { error } = await supabase
                    .from('members')
                    .update(profileData)
                    .eq('id', currentMember.id);
                
                if (error) throw error;
                
                // Update currentMember object
                currentMember = { ...currentMember, ...profileData };
                updateUserInfo();
                
                showToast('Profile updated successfully!', 'success');
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showToast('Error updating profile: ' + error.message, 'error');
            }
        }
        
        function printCard() {
            window.print();
            showToast('Preparing membership card for printing...', 'info');
        }
        
        function downloadCard() {
            showToast('Downloading membership card...', 'info');
            // In a real app, you would generate and download a PDF
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => showToast('Copied to clipboard!', 'success'))
                .catch(() => showToast('Failed to copy', 'error'));
        }
        
        function exportPayments() {
            showToast('Exporting payment history...', 'info');
        }
        
        function viewReceipt(paymentId) {
            showToast('Viewing receipt...', 'info');
        }
        
        function viewEventsForDate(date) {
            showToast('Showing events for selected date...', 'info');
        }
        
        function viewEventDetails(eventId) {
            showToast('Loading event details...', 'info');
        }
        
        async function registerForEvent(eventId) {
            try {
                const supabase = initSupabase();
                
                // Check if already registered
                const { data: existingRegistration } = await supabase
                    .from('event_registrations')
                    .select('*')
                    .eq('member_id', currentMember.id)
                    .eq('event_id', eventId)
                    .single();
                
                if (existingRegistration) {
                    showToast('You are already registered for this event!', 'info');
                    return;
                }
                
                // Create registration
                const registrationData = {
                    member_id: currentMember.id,
                    event_id: eventId,
                    registration_date: new Date().toISOString(),
                    status: 'pending',
                    registration_code: `KESNNUR-${Date.now()}`
                };
                
                const { error } = await supabase
                    .from('event_registrations')
                    .insert(registrationData);
                
                if (error) throw error;
                
                showToast('Successfully registered for the event!', 'success');
                
                // Refresh events view
                setTimeout(() => loadEventsCalendar(), 1000);
                
            } catch (error) {
                console.error('Error registering for event:', error);
                showToast('Error registering for event: ' + error.message, 'error');
            }
        }
        
        function filterEvents(category) {
            showToast(`Filtering ${category} events...`, 'info');
        }
        
        function joinChapterEvent() {
            showToast('Joining chapter meeting...', 'info');
        }
        
        function searchMembers() {
            const searchTerm = document.getElementById('searchMembers').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            
            const memberCards = document.querySelectorAll('#membersGrid > div');
            memberCards.forEach(card => {
                const name = card.querySelector('h4').textContent.toLowerCase();
                const email = card.querySelector('p.text-gray-600').textContent.toLowerCase();
                const status = card.querySelector('span').textContent.toLowerCase();
                
                const matchesSearch = name.includes(searchTerm) || email.includes(searchTerm);
                const matchesStatus = !statusFilter || status === statusFilter;
                
                card.style.display = matchesSearch && matchesStatus ? 'block' : 'none';
            });
        }
        
        function viewMemberProfile(memberId) {
            showToast('Viewing member profile...', 'info');
        }
        
        function messageMember(memberId) {
            showToast('Opening message composer...', 'info');
        }
        
        function exportMembers() {
            showToast('Exporting member list...', 'info');
        }
        
        function submitSupportRequest() {
            const subject = document.getElementById('supportSubject').value;
            const message = document.getElementById('supportMessage').value;
            
            if (!subject || !message) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            showToast('Support request submitted successfully!', 'success');
            document.getElementById('supportSubject').value = '';
            document.getElementById('supportMessage').value = '';
        }
        
        function submitContactForm() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const subject = document.getElementById('contactSubject').value;
            const department = document.getElementById('contactDepartment').value;
            const message = document.getElementById('contactMessage').value;
            
            if (!name || !email || !subject || !message) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            showToast('Message sent successfully! We\'ll get back to you soon.', 'success');
            
            // Reset form
            document.getElementById('contactForm').reset();
            document.getElementById('contactName').value = `${currentMember.first_name} ${currentMember.last_name}`;
            document.getElementById('contactEmail').value = currentMember.email;
        }
        
        function selectPlan(plan) {
            const planNames = {
                basic: 'Basic',
                professional: 'Professional',
                premium: 'Premium'
            };
            
            const planAmounts = {
                basic: '2,000',
                professional: '5,000',
                premium: '10,000'
            };
            
            document.getElementById('selectedPlanText').textContent = planNames[plan];
            document.getElementById('planAmount').textContent = `KSh ${planAmounts[plan]}`;
            document.getElementById('totalAmount').textContent = `KSh ${planAmounts[plan]}`;
        }
        
        function processPayment() {
            const plan = document.getElementById('selectedPlanText').textContent;
            if (plan === 'None') {
                showToast('Please select a membership plan first', 'error');
                return;
            }
            
            showToast('Processing payment...', 'info');
            // In a real app, you would integrate with a payment gateway
        }
        
        function cancelRegistration(registrationId) {
            if (confirm('Are you sure you want to cancel this registration?')) {
                showToast('Cancelling registration...', 'info');
                // In a real app, you would make an API call to cancel
            }
        }
        
        function downloadTicket(registrationId) {
            showToast('Downloading event ticket...', 'info');
        }
        
        function toggleNotifications() {
            showToast('Notifications feature coming soon!', 'info');
        }
        
        async function logout() {
            try {
                const supabase = initSupabase();
                const { error } = await supabase.auth.signOut();
                
                if (error) throw error;
                
                showToast('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'member-login.html';
                }, 1000);
                
            } catch (error) {
                console.error('Error logging out:', error);
                showToast('Error logging out: ' + error.message, 'error');
            }
        }
        
        // Initialize the dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
        
        // Handle page refresh - restore active section
        window.addEventListener('load', () => {
            const activeItem = document.querySelector('.nav-item.active');
            if (activeItem) {
                const section = activeItem.getAttribute('data-section');
                if (section && section !== 'dashboard') {
                    setTimeout(() => loadSection(section), 100);
                }
            }
        });
        
    </script>
</body>
</html>
